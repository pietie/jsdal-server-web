<mat-card>
  <mat-card-content>


    <mat-spinner diameter="24" *ngIf="isLoading"></mat-spinner>

    <span
      class="head">{{ exceptionDetail?.created | fromISODateStr | date:'dd MMM yyyy, HH:mm:ss' }}</span>&nbsp;<span>({{ exceptionDetail?.id }})</span>
    <br /><br />

    <div class="exception-detail" *ngIf="exceptionDetail">

      <div class="msg" [innerHTML]="formatMessage(exceptionDetail.message)"></div>
      <hr />

      <!-- <div class="stack" *ngIf="exceptionDetail.stackTrace" [innerHTML]="formatStackTrace(exceptionDetail.stackTrace)"></div>

      <hr/> -->
      <!-- <pre class="prettyprint lang-cs stack">{{ exceptionDetail?.stackTrace }}</pre> -->

      <div >
          <pre class="prettyprint " [innerHTML]='prettyPrint(exceptionDetail.stackTrace, "cs")'></pre>
        </div>

    </div>
    <!-- *ngIf="exceptionDetail && exceptionDetail.execOptions &&  exceptionDetail.execOptions.project" -->
    <div class="exec-option">
      <h3>
        jsDAL execution options
      </h3>
      <div style="display:flex; justify-content: start; align-items: center;font-size: 0.96em">
        <div class="row">
          <span class="field">Endpoint</span>
          <span #epValue (dblclick)="handleCodeDblClicked(epValue)"
            class="value">{{ exceptionDetail?.execOptions?.project }}/{{ exceptionDetail?.execOptions?.application }}/{{ exceptionDetail?.execOptions?.endpoint }}</span>
        </div>

        <div class="row">
          <span class="field">Routine</span>
          <span class="value" #routineValue
            (dblclick)="handleCodeDblClicked(routineValue)">[{{ exceptionDetail?.execOptions?.schema }}].[{{ exceptionDetail?.execOptions?.routine }}]</span>
        </div>

        <div class="row">
          <span class="field">Type</span>
          <span class="value">{{ execTypeValues[exceptionDetail?.execOptions?.type] }}</span>
        </div>

      </div>


      <ng-container #targetExecSql></ng-container>

      <div #preSqlDiv class="sql" (dblclick)="handleCodeDblClicked(preSqlDiv)">
          
        <pre class="prettyprint sql" [innerHTML]='prettyPrintExecSql()'></pre>
      </div>
      <!-- Batch stuff = {{ exceptionDetail.execOptions.OverridingInputParameters }} -->


    </div>

  </mat-card-content>
  <mat-card-actions>
    <button mat-button color="primary" routerLink="..">CLOSE</button>
  </mat-card-actions>
  <!-- <mat-card-footer>
      <mat-progress-bar mode="query"></mat-progress-bar>
  </mat-card-footer> -->
</mat-card>


<ng-template #tpl>
  <div #preSql (dblclick)="handleCodeDblClicked(preSql)" class="sql">
    <pre
      class="prettyprint lang-sql"><code class="language-sql">exec [{{ exceptionDetail?.execOptions?.schema }}].[{{ exceptionDetail?.execOptions?.routine }}] {{ buildExecParmList(exceptionDetail?.execOptions?.inputParameters) }}</code></pre>
  </div>
  <ng-template>