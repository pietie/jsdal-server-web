<div #dlg class="modal fade" sata-backdrop="static">
    <div class="modal-dialog modal-lg" style="width:95%;margin:auto">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><i class="fa fa-shield pr8"></i>Metadata browser</h4>
            </div>
            <div class="modal-body">
                <div class="form-horizontal">
                    <div class="form-group">
                        <div class="col-sm-12"><input type="text" class="form-control" placeholder="Search query" [(ngModel)]="filterQuery" (keyup.enter)="onSearchClicked()" /></div>
                    </div>


                    <div class="form-group">
                        <div class="col-xs-12">
                            <div class="form-inline">

                                <div class="form-group">
                                    <label class="col-sm-3">Type</label>
                                    <div class="col-sm-9">
                                        <select [(ngModel)]="filterType"><option value="0">(All)</option><option value="function">UDF</option><option value="procedure">Sproc</option><option value="tvf">Table-valued</option></select>

                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4">Results</label>
                                    <div class="col-sm-7">
                                        <select [(ngModel)]="filterResults"><option value="0">(All)</option><option value="1">Has error</option><option value="2">No error</option></select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-12">
                                        <label class="checkbox-inline"><input type="checkbox" [(ngModel)]="filterHasMetadata" /> Has jsDAL metadata</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-12">
                                        <label class="checkbox-inline"><input type="checkbox" [(ngModel)]="filterIsDeleted" /> Is deleted</label>
                                    </div>
                                </div>


                            </div>
                        </div>

                    </div>

                    <div class="form-group">
                        <div class="col-sm-12">
                            <br />
                            <button class="btn btn-primary" (click)="onSearchClicked()">Search</button>
                        </div>




                    </div>

                    <div style="position:relative">
                        <div *ngIf="isLoading" style="position:absolute;top: 0px;left: 20px;z-index:99;background-color:#fff"><i class="fa fa-spinner fa-pulse" style="margin-right: 6px;"></i>Loading, please wait...</div>
                    </div>
                    <div class="results" style="position:relative; overflow-y:scroll;max-height:50%;">

                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">
                                    Results
                                </h3>
                            </div>
                            <div class="panel-footer" *ngIf="searchResults">
                                Viewing <strong>{{ searchResults.length }}</strong> of <strong>{{ totalCount }}</strong> routine(s)
                            </div>
                            <div class="panel-body">

                                <table class="table table-striped table-condensed">
                                    <thead>
                                        <tr>
                                            <th style="width:80px"></th>
                                            <th>Name</th>
                                            <th style="width:80px">Parameters</th>
                                            <th style="width:100px">Results</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <ng-template [ngIf]="searchResults">
                                            <tr *ngFor="let row of searchResults" [class.deleted]="row.IsDeleted">
                                                <td class="anchorColumn">
                                                    <a>edit</a>
                                                </td>
                                                <td>[{{row.Schema}}].[{{row.Routine}}] <a *ngIf="row.jsDALMetadata?.jsDAL" (click)="showJsDALMetadata(row)" href="javascript:void(0)">(meta)</a></td>
                                                <td>
                                                    <a *ngIf="row.Parameters?.length > 0" (click)="viewParameters(row)" href="javascript:void(0)">
                                                        {{ row.Parameters.length }} {{row.Parameters.length == 1? "parm":"parms" }}
                                                    </a>

                                                    <span *ngIf="row.Parameters == null || row.Parameters.length == 0">0 parms</span>
                                                </td>
                                                <td>
                                                    <!--*ngIf="row != null && row.ResultSetMetadata != null && Object.keys(row.ResultSetMetadata).length > 0"-->
                                                    <a (click)="showTableResults(row)" href="javascript:void(0)">{{ getResultsText(row) }}</a>
                                                    <!--<span *ngIf="ResultSetError == null && (row.ResultSetMetadata == null || Object.keys(row.ResultSetMetadata).length == 0)">(no results)</span>-->
                                                </td>
                                            </tr>
                                        </ng-template>
                                        <tr *ngIf="!searchResults || searchResults.length == 0">
                                            <td colspan="100">No results found.</td>
                                        </tr>

                                    </tbody>
                                </table>



                            </div>

                            <div class="panel-footer" *ngIf="searchResults">
                                Viewing <strong>{{ searchResults.length }}</strong> of <strong>{{ totalCount }}</strong> routine(s)
                            </div>

                        </div>





                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>