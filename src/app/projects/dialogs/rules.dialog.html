<h1 mat-dialog-title><i class="fa fa-object-group pr8"></i>Manage rules - {{title}} - <span style="font-size: 12px;">By default all routines are 
        <mat-chip color='{{defaultRuleMode==0? "primary": "accent"}}' selected="true" title="This can be changed by editting the application properties">{{defaultRuleMode==0? "Included": "Excluded"}}</mat-chip>
    </span>

</h1>

<div mat-dialog-content style="min-width:800px;">

    <mat-card>
        <mat-card-title></mat-card-title>
        <mat-card-content>

            <table class="grid">
                <thead>
                    <tr>
                        <th style="width:200px"></th>
                        <th>Rule</th>
                        <th># affected</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let row of ruleList">
                        <td class="anchorNest">
                            <span *ngIf="!row.IsAppRule || row.AppLevelOnly">
                                        {{row.Ix}}.
                                        <button mat-button color="primary">edit</button>
                                        <button mat-button color="accent" (click)="onDeleteRuleClicked(row)">delete</button>
                                    </span>
                            <span *ngIf="row.IsAppRule && !row.AppLevelOnly">(Application rule)</span>
                        </td>
                        <td>
                            <span class="rule-type">{{ RuleTypeValues[row.Type] }}</span>&nbsp;{{row.Description}}</td>
                        <td>{{ row.AffectedCount }}</td>
                    </tr>
                    <tr *ngIf="!ruleList || ruleList.length == 0">
                        <td colspan="4">No rules configured yet.</td>

                    </tr>
                </tbody>
            </table>

        </mat-card-content>
        <mat-card-actions>
            <button *ngIf="!isInAddNewRuleMode" (click)="isInAddNewRuleMode=true;newTypeVal=1" color="primary" mat-button>ADD NEW <strong>{{defaultRuleMode == 0? "EXCLUSION":"INCLUSION"}}</strong> RULE</button>

        </mat-card-actions>
        <mat-card-footer>
            <mat-progress-bar *ngIf="isLoadingRules" mode="indeterminate"></mat-progress-bar>
        </mat-card-footer>
    </mat-card>

    <mat-card *ngIf="isInAddNewRuleMode">
        <mat-card-title>
            <i class="fa fa-plus-circle pr8"></i>Add new rule
        </mat-card-title>
        <mat-card-content>
            <div class="addNewRule">


                <div class="row">
                    <mat-radio-button #radSchema (click)="newTypeVal=0;txtSchema.focus()" radioGroup="newType" value="0">Schema</mat-radio-button>

                    <mat-form-field>
                        <input #txtSchema matInput type="text" autofocus [readonly]="!radSchema.checked" (click)="radSchema.checked = true;newTypeVal=0;"
                            placeholder="Schema name" />
                    </mat-form-field>
                </div>

                <div class="row">
                    <mat-radio-button #radSpecific (click)="newTypeVal=1;txtSpecific.focus()" radioGroup="newType" value="1">Specific</mat-radio-button>
                    <mat-form-field>
                        <input #txtSpecific matInput type="text" (click)="radSpecific.checked = true;newTypeVal=1" placeholder="Routine name" [readonly]="!radSpecific.checked"
                        />
                    </mat-form-field>
                </div>

                <div class="row">
                    <mat-radio-button #radRegex (click)="newTypeVal=2;txtRegex.focus();" radioGroup="newType" value="2">Regex</mat-radio-button>
                    <mat-form-field>
                        <input #txtRegex matInput type="text" (click)="radRegex.checked = true;newTypeVal=2" placeholder="C# regex" [readonly]="!radRegex.checked"
                        />
                    </mat-form-field>
                </div>
            </div>


        </mat-card-content>

        <mat-card-actions align="end">
            <button mat-button color="primary" (click)="onAddNewRuleClicked(txtSchema.value, txtSpecific.value, txtRegex.value, newTypeVal);isInAddNewRuleMode=false">ADD RULE</button>
            <button mat-button color="primary" (click)="isInAddNewRuleMode=false">CANCEL</button>

        </mat-card-actions>
    </mat-card>


    <mat-card>
        <mat-card-title>
            Full routine list
        </mat-card-title>
        <mat-card-content>

            <div *ngIf="filteredRoutineList" class="footer">Viewing <strong>{{ filteredRoutineList.length }}</strong> of <strong>{{ fullRoutineList.length }}</strong> routine(s)</div>

            <div style="display: flex;">
                <mat-form-field style="flex: 1 1 auto;">
                    <input matInput type="text" [(ngModel)]="filterTxt" placeholder="Filter text" (keyup)="onFilterTextChanged($event.target.value)"
                    />
                </mat-form-field>

            </div>
            <div style="height: 2px;margin-top:-3px;">
                <mat-progress-bar *ngIf="isFilteredListLoading" mode="indeterminate"></mat-progress-bar>
            </div>

            <table class="grid" *ngIf="filteredRoutineList">
                <thead>
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th>Reason</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let row of filteredRoutineList" class="routine" [class.included]="row.Included" [class.excluded]="row.Excluded">
                        <td class="flex-justify-center">
                            <!--Only show explicit incl/excl action if the current routine is not already in that state -->
                            <button mat-button color="primary" *ngIf="showIncludeExcludeButton(row)" (click)="onExplicitInludeOrExclude(row)" href="javascript:void(0)">{{defaultRuleMode == 0? "exclude":"include"}}</button>

                        </td>
                        <td><i class="fa pr8" [class.fa-check]="row.Included" [class.fa-times]="row.Excluded"></i> {{row.RoutineFullName}}</td>
                        <td>
                            <i title="Database metadata level" *ngIf="RoutineIncludeExcludeInstructionSourceValues[row.Source] == 'DatabaseMetadata'"
                                class="pr8 fa fa-database"><span style="font-family:Roboto">&nbsp;{{row.Reason}}</span></i>
                            <i title="JS file level" *ngIf="RoutineIncludeExcludeInstructionSourceValues[row.Source] == 'JsFileLevel'" class="pr8 fa fa-file-code-o"><span style="font-family:Roboto">&nbsp;{{row.Reason}}</span></i>
                            <i title="Application level" *ngIf="RoutineIncludeExcludeInstructionSourceValues[row.Source] == 'DbSourceLevel'" class="pr8 fa fa-square"><span style="font-family:Roboto">&nbsp;{{row.Reason}}</span></i>

                        </td>

                    </tr>
                    <tr *ngIf="needTruncation && cutOffRoutineList">
                        <td colspan="4" style="text-align:center;background-color:#f0f0f0;border:1px solid gray;padding:3px;">Results truncated. <button mat-button color="primary" (click)="cutOffRoutineList=false;refreshFilteredView(filterTxt);">CLICK HERE</button> to display all of the results.</td>
                    </tr>
                    <tr *ngIf="!filteredRoutineList || filteredRoutineList.length == 0">
                        <td colspan="4">No routines found in cache.</td>

                    </tr>
                </tbody>
            </table>

        </mat-card-content>
        <mat-card-footer>
            <mat-progress-bar *ngIf="isFilteredListLoading" mode="indeterminate"></mat-progress-bar>
        </mat-card-footer>
    </mat-card>

</div>
<div mat-dialog-actions align="end">
    <button mat-button (click)="dialogRef.close(false)">CLOSE</button>
</div>